source(file.path(root, "data.R"))
root <- "C:/Users/devin/Documents/Oeconomica-Health-Cohort"


library(dplyr)
library(ggplot2)
library(lubridate)
library(knitr)
library(purrr)
library(tidyr)
library(stringr)
library(measurements)

df <- read.csv(file.path(ddir, "health_cohort_data.csv"))


slim_df <-
  df %>%
  select(YEAR, SERIAL, STRATA, PSU, NHISHID, HHX, FMX, PX, PERWEIGHT, 
         SAMPWEIGHT, FWEIGHT, ASTATFLG, CSTATFLG, PERNUM, AGE, SEX, MARSTAT,
         # labor force / household variables
         RELATE, FAMSTRUC1F, PARENTHERE, EDUC, EMPSTAT, HOURSWRK, SECONDJOB,
         HINOAGER, HINOFAMR)

relate_codebook <-
  tibble(RELATE = c(10, 20, 21, 22, 30, 40, 41, 43, 44, 50, 60, 70, 71, 72, 73,
                    74, 75, 76, 80, 81, 82, 83, 84, 85, 90, 96, 97, 98, 99),
         relate_clean = c("Householder", 
                          "Spouse",
                          "Spouse, other spouse at home and NOT in Armed forces",
                          "Spouse, other spouse at home and in Armerd Forces",
                          "Unmarried partner",
                          "Child",
                          "Child (bio/adopt/in-law/foster) of householder",
                          "Child of partner",
                          "Child of ineligible householder",
                          "Other relative 1 (not wife, child)",
                          "Grandchild",
                          "Other relative 2 (not grandkid, child, spouse, parent)",
                          "Parent (bio/adopt/in-law/step/foster) of householder",
                          "Brother/sister (bio/adopt/in-law/step/foster)",
                          "Grandparent (Grandma/Grandpa)",
                          "Aunt/uncle",
                          "Niece/nephew",
                          "Other relative 3 (no named category",
                          "Nonrelative",
                          "Housemate/roommate",
                          "Roomer/boarder",
                          "Legal guardian",
                          "Ward",
                          "Other nonrelative",
                          "Unknown",
                          "Unknown - Don't know or refused",
                          "Unknown - Refused",
                          "Unknown - Not ascertained",
                          "Unknown - Don't know"))

empstat_codebook <-
  tibble(EMPSTAT = c(0, 11,12, 20, 30, 40, 97, 98, 99),
         empstat_clean = c("NIU",  "Working for pay at job/business",
                           "Working, w/out pay, at job/business",
                           "With job, but not at work",
                           "Unemployed",
                           "Not in labor force",
                           "Unknown-refused",
                           "Unknown-not ascertained",
                           "Unknown-don't know"))

secondjob_codebook <-
  tibble(SECONDJOB = c(0, 1, 2, 7, 8, 9),
         secondjob_clean = c("NIU", "No, don't have more than 1 job",
                             "Yes, have more than 1 job", "Unknown-refused",
                             "Unknown-not ascertained", "Unknown-don't know"))

hinoager_codebook <-
  tibble(HINOAGER = c(0, 1, 2, 9),
         hinoager_clean = c("NIU", "No","Yes", "Unknown"))


hinofamr_codebook <-
  tibble(HINOFAMR = c(0, 1, 2, 7, 8, 9),
         hinofamr_clean = c("NIU", "No","Yes", "Unknown - refused", 
                            "Unknown - not ascertained", 
                            "Unknown - don't know"))
parenthere_codebook <-
  tibble(PARENTHERE = c(0, 10, 11, 12, 20, 30, 98, 99),
         parenthere_clean = c("NIU", "One parent", "Mother, no father",
                              "Father, no mother", "Mother and father",
                              "Neither mother nor father",
                              "Unknown-not ascertained", 
                              "Unknown-don't know"))
famstruc1f_codebook <-
  tibble(FAMSTRUC1F = c(11, 12, 21, 22, 23, 31, 32, 33, 41, 42, 43, 44, 45, 99),
         famstruc1f_clean = c("Living alone", "Living with roommate",
                              "Married couple", "Unmarried couple", 
                              "All other adult only families",
                              "Mother and biological or nonbiological children only",
                              "Father and biological or nonbiological children only",
                              "All other single-adult and children families",
                              "Married or unmarried parents with biological/adoptive children only",
                              "Parent (biological or adoptive), step parent, and child(ren) only",
                              "Parent (biological or adoptive), cohabiting partner, and child(ren) only",
                              "At least 1 (biological or adoptive) parent and 1+ child(ren), and other related adults", 
                              "Other related and/or unrelated adults, 1+ child(ren), no biological or adoptive parent(s)", 
                              "Unknown"))

df_clean <-
  df %>%
  left_join(relate_codebook, by = "RELATE") %>%
  left_join(empstat_codebook, by = "EMPSTAT") %>%
  left_join(hinoager_codebook, by = "HINOAGER") %>%
  left_join(hinofamr_codebook, by = "HINOFAMR") %>%
  left_join(famstruc1f_codebook, by = "FAMSTRUC1F") %>%
  left_join(secondjob_codebook, by = "SECONDJOB")